import{d as it,j as S,I as rt,Z as ut,a2 as ct,Y as dt,m as _t,ag as vt,a1 as v,a8 as mt,o as m,n as p,p as e,t as a,L as $,q as u,M as T,H as k,F as H,s as Y,ah as pt,y as ht,Q as D,K as bt}from"./index-4a3460b5.js";import{b as ft,W as gt}from"./index-b5ee8cf2.js";import{_ as G}from"./Countdown.vue_vue_type_style_index_0_lang-02544ec9.js";import{_ as yt}from"./PaginationBar.vue_vue_type_script_setup_true_lang-ddf84a05.js";import"./index-0e9deab5.js";const xt={class:"bg-base-100 px-4 pt-3 pb-4 rounded mb-4 shadow"},wt={class:"card-title flex flex-col md:!justify-between md:!flex-row mb-2"},St={class:"truncate w-full"},Tt={class:""},Ot={key:0},Pt={class:"gap-4 mb-4 grid lg:!!grid-cols-3 auto-rows-max"},Nt={class:"bg-base-100 px-4 pt-3 pb-4 rounded shadow"},$t={class:"card-title mb-1"},kt={class:"block text-sm mb-1"},Dt={class:"h-5 w-full relative"},Et={class:"absolute inset-x-0 inset-y-0 text-center text-sm text-[#666] dark:text-[#eee] flex items-center justify-center"},At={class:"mt-6 grid grid-cols-2"},It={class:"bg-base-100 px-4 pt-3 pb-5 rounded shadow lg:!!col-span-2"},Vt={class:"card-title"},Lt={class:"px-1"},Rt={class:"flex items-center mb-4 mt-2"},Bt=e("div",{class:"w-2 h-2 rounded-full bg-error mr-3"},null,-1),Ct={class:"text-base flex-1 text-main"},Ut={class:"text-sm"},jt={class:"flex items-center mb-4"},Wt=e("div",{class:"w-2 h-2 rounded-full bg-primary mr-3"},null,-1),qt={class:"text-base flex-1 text-main"},zt={class:"text-sm"},Ft={class:"mb-4"},Ht={class:"flex items-center"},Yt=e("div",{class:"w-2 h-2 rounded-full bg-yes mr-3"},null,-1),Gt={class:"text-base flex-1 text-main"},Jt={class:"text-sm"},Kt={class:"pl-5 text-sm mt-2"},Mt={class:"flex items-center mb-1"},Qt=e("div",{class:"w-2 h-2 rounded-full bg-success mr-3"},null,-1),Zt={class:"text-base flex-1 text-main"},Xt={class:"text-sm"},te={class:"pl-5 text-sm"},ee={key:0,class:"mt-4"},se={class:"flex items-center"},oe=e("div",{class:"w-2 h-2 rounded-full bg-warning mr-3"},null,-1),ae={class:"text-base flex-1 text-main"},ne={key:0},le={key:1},ie={class:"text-sm"},re={class:"pl-5 text-sm mt-2"},ue={class:"bg-base-100 px-4 pt-3 pb-4 rounded mb-4 shadow"},ce={class:"card-title"},de={class:"overflow-x-auto"},_e={class:"table w-full table-zebra"},ve={class:"py-2 text-sm"},me={key:1,class:"py-2 text-sm"},ye=it({__name:"[proposal_id]",props:["proposal_id","chain"],setup(O){const b=O,s=S({}),c=rt(),f=ut(),R=ct(),B=dt(),J=_t();f.fetchProposal(b.proposal_id).then(t=>{var l,n,i;const o=vt(t.proposal);((l=t.proposal)==null?void 0:l.status)==="PROPOSAL_STATUS_VOTING_PERIOD"&&f.fetchTally(b.proposal_id).then(d=>{o.final_tally_result=d==null?void 0:d.tally}),s.value=o,(n=o.content)!=null&&n.changes&&((i=o.content)==null||i.changes.forEach(d=>{J.rpc.getParams(d.subspace,d.key).then(h=>{s.value.content&&h.param&&(s.value.content.current?s.value.content.current.push(h.param):s.value.content.current=[h.param])})}))});const C=v(()=>s.value.status==="PROPOSAL_STATUS_PASSED"?"success":s.value.status==="PROPOSAL_STATUS_REJECTED"?"error":""),K=v(()=>s.value.status?s.value.status.replace("PROPOSAL_STATUS_",""):""),M=S({});f.fetchProposalDeposits(b.proposal_id).then(t=>M.value=t);const E=S({}),A=S(new mt),I=S({});f.fetchProposalVotes(b.proposal_id).then(t=>{E.value=t.votes,I.value=t.pagination});function g(t){return t?c.toDay(t,"from"):""}const Q=v(()=>{const t=new Date;return new Date(s.value.voting_end_time).getTime()-t.getTime()}),Z=v(()=>{var n,i,d,h,y,x,w;const t=Number(((i=(n=s.value.content)==null?void 0:n.plan)==null?void 0:i.height)||0);if(t>0){const P=bt(),N=Number(((y=(h=(d=P.latest)==null?void 0:d.block)==null?void 0:h.header)==null?void 0:y.height)||0);return(t-N)*6*1e3}const o=new Date;return new Date(((w=(x=s.value.content)==null?void 0:x.plan)==null?void 0:w.time)||"").getTime()-o.getTime()}),_=v(()=>{const t=s.value.final_tally_result;let o=0;return t&&(o+=Number(t.abstain||(t==null?void 0:t.abstain_count)||0),o+=Number(t.yes||(t==null?void 0:t.yes_count)||0),o+=Number(t.no||(t==null?void 0:t.no_count)||0),o+=Number(t.no_with_veto||(t==null?void 0:t.no_with_veto_count)||0)),o}),X=v(()=>{var t;if(_.value>0){const o=((t=B.pool)==null?void 0:t.bonded_tokens)||"1";return _.value>=Number(o)?c.percent(1):c.percent(_.value/Number(o))}return 0}),tt=v(()=>{var t,o,l,n;if(_.value>0){const i=((o=(t=s.value)==null?void 0:t.final_tally_result)==null?void 0:o.yes)||((n=(l=s.value)==null?void 0:l.final_tally_result)==null?void 0:n.yes_count)||0;return c.percent(Number(i)/_.value)}return 0}),et=v(()=>{var t,o,l,n;if(_.value>0){const i=((o=(t=s.value)==null?void 0:t.final_tally_result)==null?void 0:o.no)||((n=(l=s.value)==null?void 0:l.final_tally_result)==null?void 0:n.no_count)||0;return c.percent(Number(i)/_.value)}return 0}),st=v(()=>{var t,o,l,n;if(_.value>0){const i=((o=(t=s.value)==null?void 0:t.final_tally_result)==null?void 0:o.no_with_veto)||((n=(l=s.value)==null?void 0:l.final_tally_result)==null?void 0:n.no_with_veto_count)||0;return c.percent(Number(i)/_.value)}return 0}),ot=v(()=>{var t,o,l,n;if(_.value>0){const i=((o=(t=s.value)==null?void 0:t.final_tally_result)==null?void 0:o.abstain)||((n=(l=s.value)==null?void 0:l.final_tally_result)==null?void 0:n.abstain_count)||0;return c.percent(Number(i)/_.value)}return 0}),at=v(()=>[{name:"Turnout",value:X.value,class:"bg-info"},{name:"Yes",value:tt.value,class:"bg-success"},{name:"No",value:et.value,class:"bg-error"},{name:"No With Veto",value:st.value,class:"bg-red-800"},{name:"Abstain",value:ot.value,class:"bg-warning"}]);function nt(t){const{data:o}=D.fromBech32(t),l=D.toHex(o),n=B.validators.find(i=>D.toHex(D.fromBech32(i.operator_address).data)===l);return n?n.description.moniker:t}function lt(t){A.value.setPage(t),f.fetchProposalVotes(b.proposal_id,A.value).then(o=>{E.value=o.votes,I.value=o.pagination})}function V(t){return t?JSON.parse(t):{}}return(t,o)=>{var l,n,i,d,h,y,x,w,P,N,U,j,W,q,z;return m(),p("div",null,[e("div",xt,[e("h2",wt,[e("p",St,a(O.proposal_id)+". "+a(s.value.title||((l=s.value.content)==null?void 0:l.title)||((i=V((n=s.value)==null?void 0:n.metadata))==null?void 0:i.title)),1),e("div",{class:$(["badge badge-ghost",u(C)==="success"?"text-yes":u(C)==="error"?"text-no":"text-info"])},a(u(K)),3)]),e("div",Tt,[T(ft,{value:s.value.content},null,8,["value"])]),s.value.summary&&!((d=s.value.content)!=null&&d.description)||(y=V((h=s.value)==null?void 0:h.metadata))!=null&&y.summary?(m(),p("div",Ot,[T(u(gt),{"model-value":u(c).multiLine(s.value.summary||((w=V((x=s.value)==null?void 0:x.metadata))==null?void 0:w.summary)),previewOnly:"",class:"md-editor-recover"},null,8,["model-value"])])):k("",!0)]),e("div",Pt,[e("div",Nt,[e("h2",$t,a(t.$t("gov.tally")),1),(m(!0),p(H,null,Y(u(at),(r,L)=>(m(),p("div",{class:"mb-1",key:L},[e("label",kt,a(r.name),1),e("div",Dt,[e("div",{class:$(["absolute inset-x-0 inset-y-0 w-full opacity-10 rounded-sm",`${r.class}`])},null,2),e("div",{class:$(["absolute inset-x-0 inset-y-0 rounded-sm",`${r.class}`]),style:pt(`width: ${r.value==="-"||r.value==="NaN%"?"0%":r.value}`)},null,6),e("p",Et,a(r.value),1)])]))),128)),e("div",At,[e("label",{for:"vote",class:"btn btn-primary float-right btn-sm mx-1",onClick:o[0]||(o[0]=r=>u(R).open("vote",{proposal_id:O.proposal_id}))},a(t.$t("gov.btn_vote")),1),e("label",{for:"deposit",class:"btn btn-primary float-right btn-sm mx-1",onClick:o[1]||(o[1]=r=>u(R).open("deposit",{proposal_id:O.proposal_id}))},a(t.$t("gov.btn_deposit")),1)])]),e("div",It,[e("h2",Vt,a(t.$t("gov.timeline")),1),e("div",Lt,[e("div",Rt,[Bt,e("div",Ct,a(t.$t("gov.submit_at"))+": "+a(u(c).toDay(s.value.submit_time)),1),e("div",Ut,a(g(s.value.submit_time)),1)]),e("div",jt,[Wt,e("div",qt,a(t.$t("gov.deposited_at"))+": "+a(u(c).toDay(s.value.status==="PROPOSAL_STATUS_DEPOSIT_PERIOD"?s.value.deposit_end_time:s.value.voting_start_time)),1),e("div",zt,a(g(s.value.status==="PROPOSAL_STATUS_DEPOSIT_PERIOD"?s.value.deposit_end_time:s.value.voting_start_time)),1)]),e("div",Ft,[e("div",Ht,[Yt,e("div",Gt,a(t.$t("gov.vote_start_from"))+" "+a(u(c).toDay(s.value.voting_start_time)),1),e("div",Jt,a(g(s.value.voting_start_time)),1)]),e("div",Kt,[T(G,{time:u(Q)},null,8,["time"])])]),e("div",null,[e("div",Mt,[Qt,e("div",Zt,a(t.$t("gov.vote_end"))+" "+a(u(c).toDay(s.value.voting_end_time)),1),e("div",Xt,a(g(s.value.voting_end_time)),1)]),e("div",te,a(t.$t("gov.current_status"))+": "+a(t.$t(`gov.proposal_statuses.${s.value.status}`)),1)]),(U=(N=(P=s.value)==null?void 0:P.content)==null?void 0:N["@type"])!=null&&U.endsWith("SoftwareUpgradeProposal")?(m(),p("div",ee,[e("div",se,[oe,e("div",ae,[ht(a(t.$t("gov.upgrade_plan"))+": ",1),Number(((W=(j=s.value.content)==null?void 0:j.plan)==null?void 0:W.height)||"0")>0?(m(),p("span",ne," (EST)")):(m(),p("span",le,a(u(c).toDay((z=(q=s.value.content)==null?void 0:q.plan)==null?void 0:z.time)),1))]),e("div",ie,a(g(s.value.voting_end_time)),1)]),e("div",re,[T(G,{time:u(Z)},null,8,["time"])])])):k("",!0)])])]),e("div",ue,[e("h2",ce,a(t.$t("gov.votes")),1),e("div",de,[e("table",_e,[e("tbody",null,[(m(!0),p(H,null,Y(E.value,(r,L)=>(m(),p("tr",{key:L},[e("td",ve,a(nt(r.voter)),1),r.option?(m(),p("td",{key:0,class:$(["py-2 text-sm",{"text-yes":r.option==="VOTE_OPTION_YES","text-gray-400":r.option==="VOTE_OPTION_ABSTAIN"}])},a(String(r.option).replace("VOTE_OPTION_","")),3)):k("",!0),r.options?(m(),p("td",me,a(r.options.map(F=>`${F.option.replace("VOTE_OPTION_","")}:${u(c).percent(F.weight)}`).join(", ")),1)):k("",!0)]))),128))])]),T(yt,{limit:A.value.limit,total:I.value.total,callback:lt},null,8,["limit","total"])])])])}}});export{ye as default};
